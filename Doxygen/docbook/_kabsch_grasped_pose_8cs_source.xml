<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__kabsch_grasped_pose_8cs_source">
<title>KabschGraspedPose.cs</title>
<indexterm><primary>O:/GitHUBMINIPRoject/Assets/LeapMotion/Modules/InteractionEngine/Scripts/Internal/KabschGraspedPose.cs</primary></indexterm>
<programlisting>00001 <emphasis role="comment">/******************************************************************************</emphasis>
00002 <emphasis role="comment">&#32;*&#32;Copyright&#32;(C)&#32;Leap&#32;Motion,&#32;Inc.&#32;2011-2018.&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*</emphasis>
00003 <emphasis role="comment">&#32;*&#32;Leap&#32;Motion&#32;proprietary&#32;and&#32;confidential.&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*</emphasis>
00004 <emphasis role="comment">&#32;*&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*</emphasis>
00005 <emphasis role="comment">&#32;*&#32;Use&#32;subject&#32;to&#32;the&#32;terms&#32;of&#32;the&#32;Leap&#32;Motion&#32;SDK&#32;Agreement&#32;available&#32;at&#32;&#32;&#32;&#32;&#32;*</emphasis>
00006 <emphasis role="comment">&#32;*&#32;https://developer.leapmotion.com/sdk_agreement,&#32;or&#32;another&#32;agreement&#32;&#32;&#32;&#32;&#32;&#32;&#32;*</emphasis>
00007 <emphasis role="comment">&#32;*&#32;between&#32;Leap&#32;Motion&#32;and&#32;you,&#32;your&#32;company&#32;or&#32;other&#32;organization.&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*</emphasis>
00008 <emphasis role="comment">&#32;******************************************************************************/</emphasis>
00009 
00010 <emphasis role="keyword">using</emphasis>&#32;System.Collections;
00011 <emphasis role="keyword">using</emphasis>&#32;System.Collections.Generic;
00012 <emphasis role="keyword">using</emphasis>&#32;<link linkend="__balloon_8cs_1a7d67e097df9376eb709b6a23aa3c7d23">UnityEngine</link>;
00013 
00014 <emphasis role="keyword">namespace&#32;</emphasis><link linkend="_namespace_leap_1_1_unity_1_1_interaction">Leap.Unity.Interaction</link>&#32;{
00015 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00025"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose">00025</link> &#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">class&#32;</emphasis><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose">KabschGraspedPose</link>&#32;:&#32;<link linkend="_interface_leap_1_1_unity_1_1_interaction_1_1_i_grasped_pose_handler">IGraspedPoseHandler</link>&#32;{
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00026"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1ae5b0bd25b1f36d85944840c5178349ce">00026</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1ae5b0bd25b1f36d85944840c5178349ce">NUM_FINGERS</link>&#32;=&#32;5;
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00027"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a6828cd893797a0af43bd25a7e13c5916">00027</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a6828cd893797a0af43bd25a7e13c5916">NUM_BONES</link>&#32;=&#32;4;
00028 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00029"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a64bea6d079b23aa85e12f322b017ed79">00029</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">enum</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a64bea6d079b23aa85e12f322b017ed79">SolveMethod</link>&#32;{
00030 &#32;&#32;&#32;&#32;&#32;&#32;SixDegreeSolve,
00031 &#32;&#32;&#32;&#32;&#32;&#32;PivotAroundOrigin
00032 &#32;&#32;&#32;&#32;}
00033 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a64bea6d079b23aa85e12f322b017ed79">SolveMethod</link>&#32;_solveMethod;
00034 
00035 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_behaviour">InteractionBehaviour</link>&#32;_intObj;
00036 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_solver">KabschSolver</link>&#32;_kabsch;
00037 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;List&lt;Vector3&gt;&#32;_points,&#32;_refPoints;
00038 
00039 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;Vector3&#32;_controllerCentroid,&#32;_objectCentroid;
00040 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<emphasis role="keywordtype">float</emphasis>&#32;_manipulatorCount;
00041 
00042 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;Dictionary&lt;InteractionController,&#32;PosePointCollection&gt;&#32;_controllerToPoints;
00043 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00044"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1aa01fe24ea822fcb0e2a99511dd617ab6">00044</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1aa01fe24ea822fcb0e2a99511dd617ab6">KabschGraspedPose</link>(<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_behaviour">InteractionBehaviour</link>&#32;interactionObj)&#32;{
00045 &#32;&#32;&#32;&#32;&#32;&#32;_intObj&#32;=&#32;interactionObj;
00046 
00047 &#32;&#32;&#32;&#32;&#32;&#32;_kabsch&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_solver">KabschSolver</link>();
00048 &#32;&#32;&#32;&#32;&#32;&#32;_points&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;List&lt;Vector3&gt;(20);&#32;_refPoints&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;List&lt;Vector3&gt;(20);
00049 &#32;&#32;&#32;&#32;&#32;&#32;_controllerToPoints&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;Dictionary&lt;InteractionController,&#32;PosePointCollection&gt;();
00050 &#32;&#32;&#32;&#32;}
00051 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00052"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a48e190a6d9cadcaf3340d339ac61d464">00052</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a48e190a6d9cadcaf3340d339ac61d464">AddController</link>(<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_controller">InteractionController</link>&#32;controller)&#32;{
00053 &#32;&#32;&#32;&#32;&#32;&#32;var&#32;newPoints&#32;=&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1a1baf5ec370452ba0450304d53c6100d6">Create</link>(_intObj.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_behaviour_1a4f54f1794944882d8cf51bd641a5341c">rigidbody</link>.position,
00054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_intObj.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_behaviour_1a4f54f1794944882d8cf51bd641a5341c">rigidbody</link>.rotation);
00055 &#32;&#32;&#32;&#32;&#32;&#32;_controllerToPoints[controller]&#32;=&#32;newPoints;
00056 
00057 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(<emphasis role="keywordtype">int</emphasis>&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;controller.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_controller_1a6f7f56adcad9f72d65f02e7490403df2">graspManipulatorPoints</link>.Count;&#32;i++)&#32;{
00058 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Vector3&#32;manipulatorPosition&#32;=&#32;controller.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_controller_1a6f7f56adcad9f72d65f02e7490403df2">graspManipulatorPoints</link>[i];
00059 
00060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;newPoints.SetWorldPosition(i,&#32;manipulatorPosition);
00061 &#32;&#32;&#32;&#32;&#32;&#32;}
00062 &#32;&#32;&#32;&#32;}
00063 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00064"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a661d3ea1067114b90addbc885691c899">00064</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a661d3ea1067114b90addbc885691c899">RemoveController</link>(<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_controller">InteractionController</link>&#32;controller)&#32;{
00065 &#32;&#32;&#32;&#32;&#32;&#32;var&#32;collection&#32;=&#32;_controllerToPoints[controller];
00066 &#32;&#32;&#32;&#32;&#32;&#32;_controllerToPoints.Remove(controller);
00067 
00068 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Return&#32;the&#32;collection&#32;to&#32;the&#32;pool&#32;so&#32;it&#32;can&#32;be&#32;re-used.</emphasis>
00069 &#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1ae6915d095bb56555964c6ea063ab18d4">Return</link>(collection);
00070 &#32;&#32;&#32;&#32;}
00071 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00072"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a016fe0af189b4caae24050a70b4d2462">00072</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a016fe0af189b4caae24050a70b4d2462">ClearControllers</link>()&#32;{
00073 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;controllerPointsPair&#32;<emphasis role="keywordflow">in</emphasis>&#32;_controllerToPoints)&#32;{
00074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1ae6915d095bb56555964c6ea063ab18d4">Return</link>(controllerPointsPair.Value);
00075 &#32;&#32;&#32;&#32;&#32;&#32;}
00076 &#32;&#32;&#32;&#32;&#32;&#32;_controllerToPoints.Clear();
00077 &#32;&#32;&#32;&#32;}
00078 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00079"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1ad691816b67d028dfc7c69e9c782c6eef">00079</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1ad691816b67d028dfc7c69e9c782c6eef">GetGraspedPosition</link>(out&#32;Vector3&#32;newPosition,&#32;out&#32;Quaternion&#32;newRotation)&#32;{
00080 &#32;&#32;&#32;&#32;&#32;&#32;_points.Clear();&#32;_refPoints.Clear();
00081 &#32;&#32;&#32;&#32;&#32;&#32;Vector3&#32;&#32;&#32;&#32;bodyPosition&#32;=&#32;_intObj.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_behaviour_1a4f54f1794944882d8cf51bd641a5341c">rigidbody</link>.position;
00082 &#32;&#32;&#32;&#32;&#32;&#32;Quaternion&#32;bodyRotation&#32;=&#32;_intObj.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_behaviour_1a4f54f1794944882d8cf51bd641a5341c">rigidbody</link>.rotation;
00083 &#32;&#32;&#32;&#32;&#32;&#32;Matrix4x4&#32;it&#32;=&#32;Matrix4x4.TRS(bodyPosition,&#32;bodyRotation,&#32;Vector3.one);
00084 
00085 &#32;&#32;&#32;&#32;&#32;&#32;_controllerCentroid&#32;=&#32;Vector3.zero;&#32;_objectCentroid&#32;=&#32;Vector3.zero;&#32;_manipulatorCount&#32;=&#32;0f;
00086 
00087 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;controllerPointPair&#32;<emphasis role="keywordflow">in</emphasis>&#32;_controllerToPoints)&#32;{
00088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_controller">InteractionController</link>&#32;controller&#32;=&#32;controllerPointPair.Key;
00089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>&#32;points&#32;=&#32;_controllerToPoints[controller];
00090 
00091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(<emphasis role="keywordtype">int</emphasis>&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;controller.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_controller_1a6f7f56adcad9f72d65f02e7490403df2">graspManipulatorPoints</link>.Count;&#32;i++)&#32;{
00092 
00093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Vector3&#32;originalManipulatorPos&#32;=&#32;points.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1aa9c5134fa34730ce67e8a46fba8bd160">GetLocalPosition</link>(i);
00094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Vector3&#32;currentManipulatorPos&#32;=&#32;controller.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_controller_1a6f7f56adcad9f72d65f02e7490403df2">graspManipulatorPoints</link>[i];
00095 
00096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Perform&#32;the&#32;solve&#32;such&#32;that&#32;the&#32;objects&apos;&#32;positions&#32;are&#32;matched&#32;to&#32;the&#32;new</emphasis>
00097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;manipulator&#32;positions.</emphasis>
00098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Vector3&#32;point1&#32;=&#32;(it.MultiplyPoint3x4(originalManipulatorPos)&#32;-&#32;bodyPosition);
00099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Vector3&#32;point2&#32;=&#32;(currentManipulatorPos&#32;-&#32;bodyPosition);
00100 
00101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(_intObj.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_interaction_behaviour_1aa2fe2de792e74492e4eb4079aacd3b6e">isPositionLocked</link>)&#32;{
00102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Only&#32;rotate&#32;the&#32;object,&#32;pivoting&#32;around&#32;its&#32;origin.</emphasis>
00103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_solveMethod&#32;=&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a64bea6d079b23aa85e12f322b017ed79">SolveMethod</link>.PivotAroundOrigin;
00104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_objectCentroid&#32;+=&#32;point1;
00105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_controllerCentroid&#32;+=&#32;point2;
00106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_manipulatorCount&#32;+=&#32;1F;
00107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Do&#32;normal&#32;Kabsch&#32;solve.</emphasis>
00110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_solveMethod&#32;=&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a64bea6d079b23aa85e12f322b017ed79">SolveMethod</link>.SixDegreeSolve;
00111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_points.Add(point1);&#32;_refPoints.Add(point2);
00112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00113 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00114 &#32;&#32;&#32;&#32;&#32;&#32;}
00115 
00116 &#32;&#32;&#32;&#32;&#32;&#32;Matrix4x4&#32;kabschTransform&#32;=&#32;PerformSolve(bodyPosition);
00117 
00118 &#32;&#32;&#32;&#32;&#32;&#32;newPosition&#32;=&#32;bodyPosition&#32;+&#32;kabschTransform.GetVector3();
00119 &#32;&#32;&#32;&#32;&#32;&#32;newRotation&#32;=&#32;kabschTransform.GetQuaternion()&#32;*&#32;bodyRotation;
00120 &#32;&#32;&#32;&#32;}
00121 
00122 &#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;Matrix4x4&#32;PerformSolve(Vector3&#32;position)&#32;{
00123 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(_solveMethod)&#32;{
00124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a64bea6d079b23aa85e12f322b017ed79">SolveMethod</link>.SixDegreeSolve:
00125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;_kabsch.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_solver_1a6aac06a0dcbe2e7ac0a53b43b64bdcaf">SolveKabsch</link>(_points,&#32;_refPoints);
00126 
00127 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1a64bea6d079b23aa85e12f322b017ed79">SolveMethod</link>.PivotAroundOrigin:
00128 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_objectCentroid&#32;/=&#32;_manipulatorCount;
00129 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_controllerCentroid&#32;/=&#32;_manipulatorCount;
00130 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!_objectCentroid.Equals(_controllerCentroid))&#32;{
00131 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;Matrix4x4.TRS(Vector3.zero,&#32;Quaternion.FromToRotation(_objectCentroid,&#32;_controllerCentroid),&#32;Vector3.one);
00132 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00133 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00134 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;Matrix4x4.identity;
00135 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00136 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:
00137 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;_kabsch.<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_solver_1a6aac06a0dcbe2e7ac0a53b43b64bdcaf">SolveKabsch</link>(_points,&#32;_refPoints);
00138 &#32;&#32;&#32;&#32;&#32;&#32;}
00139 &#32;&#32;&#32;&#32;}
00140 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00141"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">00141</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">protected</emphasis>&#32;<emphasis role="keyword">class&#32;</emphasis><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>&#32;{
00142 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Without&#32;a&#32;pool,&#32;you&#32;might&#32;end&#32;up&#32;with&#32;2&#32;instances&#32;per&#32;object</emphasis>
00143 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;With&#32;a&#32;pool,&#32;likely&#32;there&#32;will&#32;only&#32;ever&#32;be&#32;2&#32;instances!</emphasis>
00144 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<emphasis role="keyword">static</emphasis>&#32;Stack&lt;PosePointCollection&gt;&#32;_posePointCollectionPool&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;Stack&lt;PosePointCollection&gt;();
00145 
00146 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;List&lt;Vector3&gt;&#32;_localPositions;
00147 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;Matrix4x4&#32;_inverseTransformMatrix;
00148 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00149"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1a1baf5ec370452ba0450304d53c6100d6">00149</link> &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">static</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1a1baf5ec370452ba0450304d53c6100d6">Create</link>(Vector3&#32;position,
00150 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Quaternion&#32;rotation)&#32;{
00151 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>&#32;collection;
00152 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(_posePointCollectionPool.Count&#32;!=&#32;0)&#32;{
00153 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;collection&#32;=&#32;_posePointCollectionPool.Pop();
00154 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00155 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;collection&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>();
00156 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00157 
00158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;collection.Initialize(position,&#32;rotation);
00159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;collection;
00160 &#32;&#32;&#32;&#32;&#32;&#32;}
00161 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00162"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1ae6915d095bb56555964c6ea063ab18d4">00162</link> &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1ae6915d095bb56555964c6ea063ab18d4">Return</link>(<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>&#32;posePointCollection)&#32;{
00163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_posePointCollectionPool.Push(posePointCollection);
00164 &#32;&#32;&#32;&#32;&#32;&#32;}
00165 
00166 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection">PosePointCollection</link>()&#32;{
00167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_localPositions&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;List&lt;Vector3&gt;();
00168 &#32;&#32;&#32;&#32;&#32;&#32;}
00169 
00170 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;Initialize(Vector3&#32;position,&#32;Quaternion&#32;rotation)&#32;{
00171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_inverseTransformMatrix&#32;=&#32;Matrix4x4.TRS(position,&#32;rotation,&#32;Vector3.one).inverse;
00172 &#32;&#32;&#32;&#32;&#32;&#32;}
00173 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00174"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1ae80589ef2b221a47b00900147289b99a">00174</link> &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1ae80589ef2b221a47b00900147289b99a">SetWorldPosition</link>(<emphasis role="keywordtype">int</emphasis>&#32;index,&#32;Vector3&#32;worldPosition)&#32;{
00175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Vector3&#32;localPosition&#32;=&#32;_inverseTransformMatrix.MultiplyPoint3x4(worldPosition);
00176 
00177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(index&#32;&gt;&#32;_localPositions.Count)&#32;{
00178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Debug.LogError(<emphasis role="stringliteral">&quot;SetWorldPosition&#32;requires&#32;setting&#32;indices&#32;in&#32;order&#32;from&#32;0.&quot;</emphasis>);
00179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00180 
00181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(_localPositions.Count&#32;==&#32;index)&#32;{
00182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_localPositions.Add(localPosition);
00183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
00185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;_localPositions[index]&#32;=&#32;localPosition;
00186 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00187 &#32;&#32;&#32;&#32;&#32;&#32;}
00188 
<anchor xml:id="__kabsch_grasped_pose_8cs_source_1l00189"/><link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1aa9c5134fa34730ce67e8a46fba8bd160">00189</link> &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;Vector3&#32;<link linkend="_class_leap_1_1_unity_1_1_interaction_1_1_kabsch_grasped_pose_1_1_pose_point_collection_1aa9c5134fa34730ce67e8a46fba8bd160">GetLocalPosition</link>(<emphasis role="keywordtype">int</emphasis>&#32;index)&#32;{
00190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;_localPositions[index];
00191 &#32;&#32;&#32;&#32;&#32;&#32;}
00192 &#32;&#32;&#32;&#32;}
00193 
00194 &#32;&#32;}
00195 
00196 }
</programlisting></section>
